@(model: controllers.ApplicationModel)(implicit request: RequestHeader)

@import builder.properties.BuilderProperties

@name(app: snap.AppConfig) = {
  @app.cachedName.getOrElse(app.id)
}
@className(app: snap.AppConfig) = {@if(app.cachedName.getOrElse(app.id) == model.name) {default} else {}}


<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>Typesafe Builder</title>
		<script type="text/javascript">
		window.wsUrl = '@routes.Application.connectApp(model.id).webSocketURL()';
		window.serverAppModel = {
      name: '@model.name',
      id: '@model.id',
      appVersion: '@BuilderProperties.APP_VERSION',
      pluginIds:  [ @Html(model.plugins.mkString("\'", "\','","\'")) ],
      location: '@model.jsLocation'
      @for(id <- model.template) {
        ,template: {
      	  id: '@model.template'
        }
      }
    };
		</script>
		<script data-main="/public/javascripts/main.js" type="text/javascript" src="/public/javascripts/vendors/require.min.js"></script>
		<link rel="stylesheet" media="screen" href="/public/stylesheets/main.css">
		<link rel="shortcut icon" type="image/png" href="/public/images/favicon.png">

        <!-- ZenDesk Integration -->
        <script type="text/javascript" src="//assets.zendesk.com/external/zenbox/v2.6/zenbox.js"></script>
        <style type="text/css" media="screen, projection">
            @@import url(//assets.zendesk.com/external/zenbox/v2.6/zenbox.css);
        </style>
	</head>
	<body class="noAnim right-open">
		<header>
			<nav>
				<ul class="rockets">
					<li class="app" data-bind="foreach: plugins.list">
						<a data-bind="attr: { 'data-icon': icon, href: url }, css: {active: active, busy: statusBusy, error: statusError}">
                            <span class="text" data-bind="text: name"></span>
                            <span class="icon"></span>
						</a>
					</li>
				</ul>
			</nav>
			<div id="switch">
				<span class="label" data-bind="text: snap.appName"></span>
				<div>
					<ul>
                        <li class="newApp">
                            <a href="@routes.Application.forceHome">New Application</a>
                        </li>
                        @model.recentApps.zipWithIndex.map { case (app, idx) =>
                        <li>
                            <a href="@routes.Application.app(app.id)" class="@className(app)">@name(app)<br><span class="counter">@(idx+1)</span></a>
                        </li>
                        }
					</ul>
				</div>
			</div>
			<a href="http://www.typesafe.com" id="typesafe">Typesafe</a>
		</header>
		<aside class="tutorial" data-bind="snapView: tutorial">
		</aside>
		<!-- -->
        <div id="welcome-holder">
          <div id="welcome-message">
            <span class="title">Your application is ready!</span>
            <br/><br/>
            <p>
                Use <a href="#code" class="shortcut">Code</a> <a href="#compile" class="shortcut">Compile</a> <a href="#run" class="shortcut">Run</a> and <a href="#test" class="shortcut">Test</a> above to interact with the application.
            </p>
            <p class="version-info">
                Typesafe Builder v@BuilderProperties.APP_VERSION (<a href="http://myaccount.zendesk.com/account/dropboxes/20150671" onClick="script: Zenbox.show(); return false;">Send Feedback</a>)
            </p>
            <div data-bind="html: newsHtml">
            </div>
          </div>
        </div>
        <div id="wrapper" data-bind="foreach: { data: widgets }, visible: snap.activeWidget() != undefined">
          <div class="widget" data-bind="snapView: $data, visible: id == $parent.snap.activeWidget()"></div>
        </div>
        <script type="text/javascript">
            if (typeof(Zenbox) !== "undefined") {
                Zenbox.init({
                    dropboxID:   "20150671",
                    url:         "https://typesafe.zendesk.com",
                    tabID:       "feedback",
                    tabText:     "Feedback",
                    tabColor:    "black",
                    tabPosition: "Right",
                    hide_tab:    "true"
                });
            }
        </script>
	</body>
</html>
